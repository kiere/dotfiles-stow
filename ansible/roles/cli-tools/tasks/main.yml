---
# CLI tools installation
# Supports: Fedora, Ubuntu/Pop!_OS, Arch Linux/CachyOS

- name: Install CLI tools from package manager
  ansible.builtin.package:
    name: "{{ pkg_cli_tools }}"
    state: present
  become: true

# eza - install via cargo on Fedora/Ubuntu (not in repos)
- name: Install eza via cargo (Fedora/Debian)
  ansible.builtin.command:
    cmd: cargo install eza
    creates: "{{ user_home }}/.cargo/bin/eza"
  when: ansible_facts['distribution'] not in distros_arch
  environment:
    PATH: "{{ ansible_facts['env']['PATH'] }}:{{ user_home }}/.cargo/bin"

# starship - install via curl on Fedora/Ubuntu
- name: Install starship prompt (Fedora/Debian)
  ansible.builtin.shell: |
    set -o pipefail
    curl -sS https://starship.rs/install.sh | sh -s -- -y
  args:
    executable: /bin/bash
    creates: /usr/local/bin/starship
  become: true
  when: ansible_facts['distribution'] not in distros_arch

# Arch has starship in official repos (already in pkg_cli_tools)

# yazi - terminal file manager
- name: Enable yazi COPR repo (Fedora)
  community.general.copr:
    name: "{{ yazi_copr_repo }}"
    state: enabled
  become: true
  when:
    - ansible_facts['distribution'] in distros_fedora
    - yazi_copr_repo is defined

- name: Install yazi (Fedora)
  ansible.builtin.dnf:
    name: "{{ pkg_yazi }}"
    state: present
  become: true
  when:
    - ansible_facts['distribution'] in distros_fedora
    - pkg_yazi is defined

# Arch has yazi in official repos (already in pkg_cli_tools)

- name: Display CLI tools installation complete
  ansible.builtin.debug:
    msg: |
      CLI tools installed!
      - yazi (terminal file manager)
      - btop, dust, bat, zoxide, starship, etc.

      Add to ~/.bashrc:
        eval "$(zoxide init bash)"
        eval "$(starship init bash)"
